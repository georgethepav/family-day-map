<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Family Day Animated Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    #map {
      height: 100vh;
      width: 100vw;
    }

    /* Bottom timeline + legend */
    #controls {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 1000;
      background: rgba(255, 255, 255, 0.95);
      padding: 8px 16px;
      font-family: sans-serif;
      box-shadow: 0 -2px 6px rgba(0,0,0,0.15);
    }
    #controls-inner {
      max-width: 900px;
      margin: 0 auto;
    }
    #slider-row {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 6px;
    }
    #time-display {
      font-weight: bold;
      font-size: 14px;
      white-space: nowrap;
    }
    #time-slider {
      width: 100%;
    }
    #legend {
      display: flex;
      flex-wrap: wrap;
      gap: 8px 12px;
      font-size: 13px;
      line-height: 1.4;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .swatch {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      border: 1px solid #000;
    }
    .alex { background: pink; }
    .granny { background: red; }
    .billy { background: lightblue; }
    .grandad { background: darkblue; }
    .estelle { background: purple; }
    .george { background: green; }

    /* Top-right location list */
    #places-legend {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 1000;
      background: rgba(255, 255, 255, 0.9);
      padding: 8px 10px;
      border-radius: 8px;
      font-family: sans-serif;
      font-size: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      max-width: 260px;
    }
    #places-legend-title {
      font-weight: bold;
      margin-bottom: 4px;
    }
    .place-item {
      display: flex;
      align-items: flex-start;
      gap: 6px;
      margin-bottom: 2px;
    }
    .place-pin {
      font-size: 12px;
      line-height: 1.2;
    }

    /* Play/Pause Button */
    #play-pause {
      padding: 4px 10px;
      font-size: 13px;
      border-radius: 6px;
      border: 1px solid #888;
      background: #f5f5f5;
      cursor: pointer;
      white-space: nowrap;
    }
    #play-pause:hover {
      background: #e5e5e5;
    }
  </style>
</head>
<body>

<!-- Top-right location legend -->
<div id="places-legend">
  <div id="places-legend-title">Locations</div>
  <div class="place-item"><span class="place-pin">üìç</span><span>Home ‚Äì 21 Cannon St</span></div>
  <div class="place-item"><span class="place-pin">üìç</span><span>Ballet ‚Äì St Giles, West Bridgford</span></div>
  <div class="place-item"><span class="place-pin">üìç</span><span>Football ‚Äì Digby Avenue, Mapperley</span></div>
  <div class="place-item"><span class="place-pin">üìç</span><span>Swimming ‚Äì Arnold Leisure Centre</span></div>
  <div class="place-item"><span class="place-pin">üìç</span><span>Paviors ‚Äì Burntstump Hill, Arnold</span></div>
  <div class="place-item"><span class="place-pin">üìç</span><span>Granny & Grandad ‚Äì Burton Joyce</span></div>
  <div class="place-item"><span class="place-pin">üìç</span><span>Party ‚Äì Gedling Road, Woodthorpe</span></div>
  <div class="place-item"><span class="place-pin">üìç</span><span>Estelle‚Äôs Work ‚Äì Broxtowe Police Station</span></div>
</div>

<!-- Bottom panel -->
<div id="controls">
  <div id="controls-inner">
    <div id="slider-row">
      <div id="time-display">Time: 08:30</div>
      <button id="play-pause">Pause</button>
      <input type="range" id="time-slider" min="510" max="990" value="510" step="1" />
    </div>
    <div id="legend">
      <div class="legend-item"><span class="swatch alex"></span> Alex</div>
      <div class="legend-item"><span class="swatch estelle"></span> Estelle</div>
      <div class="legend-item"><span class="swatch billy"></span> Billy</div>
      <div class="legend-item"><span class="swatch george"></span> George</div>
      <div class="legend-item"><span class="swatch granny"></span> Granny</div>
      <div class="legend-item"><span class="swatch grandad"></span> Grandad</div>
    </div>
  </div>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// --- Time helper ---
function toMinutes(t) {
  const [h, m] = t.split(":").map(Number);
  return h * 60 + m;
}

// --- All locations ---
const locations = {
  house:   [52.954205, -1.146630],
  ballet:  [52.930870, -1.129820],
  football:[52.988680, -1.111820],
  swimming:[53.000690, -1.133000],
  paviors: [53.023270, -1.142700],
  granny:  [52.986890, -1.032500],
  party:   [52.993650, -1.132550],
  work:    [52.979500, -1.214000]
};

// --- Map ---
const map = L.map('map').setView([52.97, -1.14], 12);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

// Pins with popups
const placeLabels = {
  house:"Home", ballet:"Ballet", football:"Football", swimming:"Swimming",
  paviors:"Paviors", granny:"Granny & Grandad", party:"Party", work:"Estelle's Work"
};
for (const key in locations) {
  L.marker(locations[key]).addTo(map).bindPopup(placeLabels[key]);
}

// --- People & colours ---
const colours = {
  alex:'pink', granny:'red', billy:'lightblue',
  grandad:'darkblue', estelle:'purple', george:'green'
};

const defaultLocation = {
  alex:'house', estelle:'house', billy:'house', george:'house',
  granny:'granny', grandad:'granny'
};

// --- Offsets (reduced to good size) ---
const offsets = {
  alex:[0.003,0], estelle:[-0.003,0],
  billy:[0,0.003], george:[0,-0.003],
  granny:[0.002,0.002], grandad:[-0.002,-0.002]
};

function applyOffset(latlng, person) {
  const off = offsets[person] || [0,0];
  return [latlng[0] + off[0], latlng[1] + off[1]];
}

// Time segments helper
function seg(start,end,from,to){ return {
  start: toMinutes(start), end: toMinutes(end), from, to
}; }

// --- Schedules ---
const schedules = {
  estelle:[
    seg('08:30','09:00','house','ballet'),
    seg('09:45','10:25','ballet','swimming'),
    seg('11:30','11:45','swimming','house'),
    seg('13:00','13:20','house','granny'),
    seg('13:30','14:00','granny','party'),
    seg('14:05','14:30','party','work')
  ],
  alex:[
    seg('08:30','09:00','house','ballet'),
    seg('09:45','10:25','ballet','swimming'),
    seg('11:30','11:45','swimming','house'),
    seg('13:00','13:20','house','granny'),
    seg('13:45','14:15','granny','paviors'),
    seg('15:30','16:00','paviors','party'),
    seg('16:00','16:30','party','paviors')
  ],
  billy:[
    seg('08:45','09:00','house','football'),
    seg('10:00','10:10','football','house'),
    seg('13:00','13:20','house','granny'),
    seg('13:30','14:00','granny','party'),
    seg('16:00','16:30','party','paviors')
  ],
  george:[
    seg('08:45','09:00','house','football'),
    seg('10:00','10:10','football','house'),
    seg('11:55','12:15','house','granny'),
    seg('12:15','12:45','granny','paviors')
  ],
  grandad:[ seg('12:15','12:45','granny','paviors') ],
  granny:[
    seg('13:45','14:15','granny','paviors'),
    seg('15:30','16:00','paviors','party'),
    seg('16:00','16:30','party','paviors')
  ]
};

// --- Create markers (with REAL black border) ---
const markers = {};
for (const person in colours) {
  const start = locations[defaultLocation[person]];
  markers[person] = L.circleMarker(applyOffset(start, person), {
    radius: 10,
    stroke: true,
    fill: true,
    color: "black",      // <-- visible border
    weight: 3,           // <-- thickness
    fillColor: colours[person],
    fillOpacity: 1
  })
.addTo(map)
.bindTooltip(person.charAt(0).toUpperCase()+person.slice(1),{offset:[10,0]});
}

// Position calculation
function getPositionFor(person,t){
  const s=schedules[person]; if(!s) return applyOffset(locations[defaultLocation[person]],person);
  if(t<s[0].start) return applyOffset(locations[defaultLocation[person]],person);
  if(t>s[s.length-1].end) return applyOffset(locations[s[s.length-1].to],person);
  for(const seg of s){
    if(t>=seg.start && t<=seg.end){
      const r=(t-seg.start)/(seg.end-seg.start||1);
      const a=locations[seg.from], b=locations[seg.to];
      return applyOffset([a[0]+(b[0]-a[0])*r, a[1]+(b[1]-a[1])*r], person);
    }
  }
  for(let i=0;i<s.length-1;i++){
    if(t>s[i].end && t<s[i+1].start) return applyOffset(locations[s[i].to],person);
  }
  return applyOffset(locations[defaultLocation[person]],person);
}

// Timeline / animation
let currentTime = Number(timeSlider.min);
function updateAll(t){
  currentTime=t;
  for(const p in markers) markers[p].setLatLng(getPositionFor(p,t));
  timeDisplay.textContent = "Time: "+formatTime(t);
}
updateAll(currentTime);

let isPlaying=true, dragging=false;

timeSlider.oninput=e=>{dragging=true;updateAll(+e.target.value);}
timeSlider.onchange=e=>{dragging=false;}

playPauseBtn.onclick=()=>{
  isPlaying=!isPlaying;
  playPauseBtn.textContent=isPlaying?"Pause":"Play";
};

setInterval(()=>{
  if(!isPlaying||dragging) return;
  if(++currentTime>Number(timeSlider.max)){
    currentTime=Number(timeSlider.max);
    isPlaying=false;
    playPauseBtn.textContent="Play";
  }
  timeSlider.value=currentTime;
  updateAll(currentTime);
},300);
</script>
</body>
</html>
